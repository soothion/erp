<div class="row">
	<div class="col col-lg-12">
		<div class="panel panel-default">
			<div class="panel-heading"><h3 class="panel-title">调度单管理</h3></div>

			<div class="panel-body">
				<div class="container-fluid">
					<form name="editForm" class="">
						<div class="row">
							<div class="col col-sm-3">
								<div class="form-group"
									ng-class="{'has-error':editForm.invoice.$invalid}">
									<label class="control-label">Invoice</label>
									<input type="text" name="invoice" ng-model="dispatch.invoice" ng-disabled="dispatch.status!='pending'"
										class="form-control"
										required>
									
									<span ng-show="editForm.invoice.$error.required"
										class="help-inline">Required</span>
								</div>
							</div>
							<div class="col col-sm-3">
								<div class="form-group"
									ng-class="{'has-error':dispatch.status.$invalid}">
									<label class="control-label">状态</label>
									<input name="status" class="form-control"
										ng-model="dispatch.status" disabled />
									<span ng-show="editForm.status.$error.required"
										class="help-inline">Required</span>
								</div>
							</div>
							
							<div class="col col-sm-3">
								<div class="form-group"
									ng-class="{'has-error':editForm.from_warehouse_id.$invalid || dispatch.warehouse_from_id==dispatch.warehouse_to_id}">
									<label class="control-label">调出仓库</label>									
									<select name="warehouse_from_id" class="form-control" ng-disabled="dispatch.status!='pending'"
										ng-model="dispatch.warehouse_from_id"
										ng-options="w.id as w.name for w in warehouses"  required>
										<option value="">--请选择--</option>
									</select>
									
									<span ng-show="editForm.from_warehouse_id.$error.required"	class="help-inline">Required</span>
									<span ng-show="dispatch.warehouse_from_id==dispatch.warehouse_to_id" class="help-inline">出入库仓库不能一样</span>
								</div>
							</div>
							
							<div class="col col-sm-3">
								<div class="form-group"
									ng-class="{'has-error':editForm.to_warehouse_id.$invalid || dispatch.warehouse_from_id==dispatch.warehouse_to_id}">
									<label class="control-label">调入仓库</label>
									<select name="warehouse_to_id" class="form-control" ng-disabled="dispatch.status!='pending'"
										ng-model="dispatch.warehouse_to_id"
										ng-options="w.id as w.name for w in warehouses" required>
										<option value="">--请选择--</option>
										<span ng-show="editForm.to_warehouse_id.$error.required" class="help-inline">Required</span>
									</select>
									<span ng-show="editForm.to_warehouse_id.$error.required" class="help-inline">Required</span>
									<span ng-show="dispatch.warehouse_from_id==dispatch.warehouse_to_id" class="help-inline">出入库仓库不能一样</span>									
								</div>
							</div>
						</div>

						<div class="row">
							<div class="col col-sm-3">
								<div class="form-group"
									ng-class="{'has-error': editForm.dateOut.$invalid}">
									<label class="control-label">出库时间</label>
									<input type="text" ng-model="dispatch.date_out" ng-disabled="dispatch.status!='pending'"
											class="form-control" placeholder=""
											datepicker-popup="yyyy-MM-dd">	
									<span ng-show="editForm.date_out.$error.required"
										class="help-inline">Required</span>							
								</div>
							</div>
							
							<div class="col col-sm-3">
								<div class="form-group"
									ng-class="{'has-error': editForm..date_eta.$invalid}">
									<label class="control-label">入库时间</label>
									<input name="date_eta" type="text" ng-model="dispatch.date_eta" ng-disabled="dispatch.status!='pending'"
											class="form-control" placeholder=""
											datepicker-popup="yyyy-MM-dd">	
									<span ng-show="editForm.date_eta.$error.required"
										class="help-inline">Required</span>									
								</div>
							</div>
							
							<div class="col col-sm-3">
								<div class="form-group"
									ng-class="{'has-error': editForm..date_receive.$invalid}">
									<label class="control-label">接收时间</label>
									<input name="date_receive" type="text" ng-model="dispatch.date_receive" ng-disabled="dispatch.status!='pending'"
											class="form-control" placeholder=""
											datepicker-popup="yyyy-MM-dd">	
									<span ng-show="editForm.date_receive.$error.required"
										class="help-inline">Required</span>									
								</div>
							</div>
							
							
							<div class="col col-sm-3">
								<div class="form-group"
									ng-class="{'has-error':editForm.currency.$invalid}">
									<label class="control-label">currency</label>
									<select name="currency" class="form-control"
										ng-model="dispatch.currency" ng-disabled="dispatch.status!='pending'" required>
										<option value="CNY">CNY</option>
										<option value="USD">USD</option>
									</select>
									<span ng-show="editForm.currency.$error.required"
										class="help-inline">Required</span>
								</div>
							</div>

						</div>
						
						<div class="row">
							<div class="col col-sm-3">
								<div class="form-group"
									ng-class="{'has-error':editForm.transportation.$invalid}">
									<label class="control-label">transportation</label>
									<select name="transportation" class="form-control" ng-disabled="dispatch.status!='pending'"
										ng-model="dispatch.transportation"
										ng-options="w.id as w.name for w in TsStatus" required>
										<option value="">--请选择--</option>
										<span ng-show="editForm.transportation.$error.required" class="help-inline">Required</span>
									</select>									
									<span ng-show="editForm.transportation.$error.required"
										class="help-inline">Required</span>
								</div>
							</div>
							
							<div class="col col-sm-3">
								<div class="form-group"
									ng-class="{'has-error':editForm.carrier.$invalid}">
									<label class="control-label">carrier</label>
									<input type="text" name="carrier" ng-model="dispatch.carrier" ng-disabled="dispatch.status!='pending'"
										class="form-control"
										required>
									<span ng-show="editForm.carrier.$error.required"
										class="help-inline">Required</span>
								</div>
							</div>
							
							<div class="col col-sm-3">
								<div class="form-group"
									ng-class="{'has-error':editForm.tracking.$invalid}">
									<label class="control-label">tracking</label>
									<input type="text" name="tracking" ng-model="dispatch.tracking" ng-disabled="dispatch.status!='pending'"
										class="form-control"
										required>
									<span ng-show="editForm.tracking.$error.required"
										class="help-inline">Required</span>
								</div>
							</div>
							
							<div class="col col-sm-3">
								<div class="form-group"
									ng-class="{'has-error':editForm.shipping_fee.$invalid}">
									<label class="control-label">shipping_fee</label>
									<input type="text" name="shipping_fee" ng-model="dispatch.shipping_fee" ng-disabled="dispatch.status!='pending'"
										class="form-control" ng-pattern="/^\d+\.?\d*$/"
										required>
									<span ng-show="editForm.shipping_fee.$error.required"
										class="help-inline">Required</span>
								</div>
							</div>
						</div>

						<div class="row">

							<div class="col col-sm-3">
								<div class="form-group"
									ng-class="{'has-error':editForm.exchange_rate.$invalid}">
									<label class="control-label">exchange_rate</label>
									<input type="text" name="exchange_rate" ng-disabled="dispatch.status!='pending'"
									ng-pattern="/^\d+\.?\d*$/"	ng-model="dispatch.exchange_rate" class="form-control" required>
									<span ng-show="editForm.exchange_rate.$error.required"
										class="help-inline">Required</span>
								</div>
							</div>
						</div>

						<div class="row">
							<div class="col col-sm-12">
								<div class="form-group"
									ng-class="{'has-error':editForm.note.$invalid}">
									<label class="control-label">备注</label>
									<textarea name="note" class="form-control" ng-disabled="dispatch.status!='pending'"
										ng-model="dispatch.note">
									</textarea>
								</div>
							</div>
						</div>
						

						
						
						<div class="row">
						<ul class="nav nav-tabs" id="shipment">
						  <li class="active"><a id="1" >维护明细</a></li>
						  <li><a id="2" >导入明细</a></li>
						</ul>

						<div id="div1"  style="width:100%;overflow:scroll;" >
								<div class="col col-lg-12">
									<table class="table table-striped table-hover">
										<thead>
											<tr>
												<th ng-show="dispatch.status == 'pending'">
													<a href="javascript:;" ng-click="details_new()" ng-show="dispatch.status=='pending'">
														<i class="glyphicon glyphicon-plus"></i>
													</a>
												</th>
												<th>SKU</th>
												<th>描述</th>
												<th>数量</th>
												<th>pi_price</th>
												<th>box_id</th>
											</tr>
										</thead>
										<tbody>
											<tr ng-repeat="detail in dispatch.details">
												<td ng-show="dispatch.status == 'pending'">
													<a href="javascript:;" ng-click="details_remove($index)"  ng-show="dispatch.status=='pending'">
														<i class="glyphicon glyphicon-remove"></i>
													</a>				
												</td>
												<td ng-show="dispatch.status == 'pending'">
													<ng-form name="nskuform">
														<div class="form-group" ng-class="{'has-error': nskuform.sku.$invalid || ! detail.item }">
															<input type="text" name="sku" ng-model="detail.item" typeahead="item as item.sku for item in skus | filter: {sku: $viewValue} | limitTo: 10"
									data-placement="top" data-toggle="tooltip" href="#" data-original-title="{{detail.item.description}}" class="form-control" typeahead-editable="false" required>
														</div>
											form		</ng-form>
												</td>
												<td ng-show="dispatch.status != 'pending'">
													{{detail.item.sku}}
												</td>
												
												<td>{{detail.item.description}}</td>	
																						
												<td ng-show="dispatch.status == 'pending'">
													<ng-form name="nqtyform">
														<div class="form-group" ng-class="{'has-error': nqtyform.qty.$invalid}">														
															<input type="text" name="qty" ng-model="detail.qty" ng-pattern="/^[0-9]+$/" class="form-control" required>
														</div>
													</ng-form>
												</td>
												<td ng-show="dispatch.status != 'pending'">
													{{detail.qty}}
												</td>
												
												<td ng-show="dispatch.status == 'pending'">
													<ng-form name="pi_priceform">
														<div class="form-group" ng-class="{'has-error': pi_priceform.pi_price.$invalid}">
															<input type="text" name="pi_price" ng-model="detail.pi_price" class="form-control" 
															ng-pattern="/^\d+\.?\d*$/"
															required>
														</div>
													</ng-form>
												</td>
												<td ng-show="dispatch.status != 'pending'">
													{{detail.pi_price}}
												</td>
												
												<td ng-show="dispatch.status == 'pending'">
													<ng-form name="boxform">
														<div class="form-group" ng-class="{'has-error': boxform.box_id.$invalid}">
															<input type="text" name="box_id" ng-model="detail.box_id" class="form-control" required>
														</div>
													</ng-form>
												</td>
												<td ng-show="dispatch.status != 'pending'">
													{{detail.box_id}}
												</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
							</form>    

							<div id="div2"  style="width:100%;overflow:scroll;"  ng-show="false">
								 <br>
								 <input type="button" style="width:150px;" name="" class="btn btn-primary"  id="" value="下载导入模板">
								 <!--div ng-controller="uploadCtrl" style="position:absolute;bottom:5px;right:0px">
									<form action="api/purchase/requestImport/{{request.id}}" method="post" enctype="multipart/form-data" ng-upload >
										<div class="input-group" style="width:380px;margin-bottom: 10px;">
										
											  <span class="btn btn-success btn-file "> Add files...
													<input type="file" multiple="" name="file" onchange="changeValue(this.value)" style="border-radius:0px;">
												</span>
											  <span><input type="text" readonly="" class="form-control" id="fileUpload"></span>
											<span><input type="hidden" value="{{request.id}}" name="id"/>
										    <input style="margin-left:5px;" type="submit" class="btn btn-primary" value="Upload" upload-submit="uploadComplete(content, completed)"/></span>
										    
										</div>
									</form>
								</div-->
							</div>
						</div>
						</br>


						<a class="btn btn-default" href="#/warehouse/dispatch">取消</a>
						<button type="button" class="btn btn-primary" ng-click="update()" ng-show="dispatch.status == 'pending'" ng-disabled="isClean() || editForm.$invalid || nskuform.$invalid || nqtyform.$invalid || pi_priceform.$invalid || boxform.$invalid || dispatch.warehouse_from_id==dispatch.warehouse_to_id">保存</button>
						<button type="button" class="btn btn-info" ng-click="confirm()" ng-show="dispatch.status == 'pending'" ng-disabled=" editForm.$invalid || nskuform.$invalid || nqtyform.$invalid || pi_priceform.$invalid || boxform.$invalid || dispatch.details.length<1 || dispatch.warehouse_from_id==dispatch.warehouse_to_id">确认</button>
						<button type="button" class="btn btn-info" ng-click="generate()" ng-show="dispatch.status == 'confirmed'">Generate</button>
						<button type="button" class="btn btn-info" ng-click="" ng-show="dispatch.status == 'confirmed'">生成条码</button>
						<button type="button" class="btn btn-info" ng-click="" ng-show="dispatch.status == 'confirmed'">查看条码</button>
						<a class="btn btn-primary" href="#/warehouse/dispatch/specail/{{dispatch.id}}" class="btn btn-danger"  ng-show="dispatch.status != 'pending'">特殊修改</a>	
				</div>
			</div>
		</div>
	</div>
</div>



